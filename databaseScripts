
-- CREATE SCHEMA SHIPPING;
SET SEARCH_PATH = PUBLIC, PG_CATALOG;

-- CREATE THE LOCATION ENTITY.
CREATE TABLE LOCATION
    (   LOCATION_CODE       INTEGER           NOT NULL,
        LOCATION_TYPE_CODE  CHAR VARYING(5)   NOT NULL,
        NAME                CHAR VARYING(80)  NOT NULL,
        FORMAT              CHAR VARYING (20),
        COUNTY              CHAR VARYING(40),
        POSTCODE            CHAR VARYING(10),
        COUNTRY             CHAR VARYING(40),
        REPORTING_REGION    CHAR VARYING(20)
    );

ALTER TABLE LOCATION
    OWNER TO POSTGRES;

ALTER TABLE ONLY LOCATION
    ADD CONSTRAINT LOCATION_PK
       PRIMARY KEY
        (   LOCATION_CODE
        );

-- create location route sequence.
create sequence
    route_number_sequence
        minvalue 0 maxvalue 2147483647;

-- CREATE THE ROUTE ENTITY.
CREATE TABLE ROUTE
    (   ROUTE_NUMBER            INTEGER      NOT NULL,
        LOCATION_CODE_START     INTEGER      NOT NULL
            REFERENCES LOCATION (LOCATION_CODE),
        LOCATION_CODE_END       INTEGER      NOT NULL
            REFERENCES LOCATION (LOCATION_CODE),
        ROUTE_TYPE_CODE    CHAR VARYING(5)   NOT NULL,
        START_DATE              DATE         NOT NULL,
        END_DATE                DATE         NOT NULL
    );

ALTER TABLE ROUTE
    OWNER TO POSTGRES;

ALTER TABLE ONLY ROUTE
    ADD CONSTRAINT ROUTE_PK
       PRIMARY KEY (    ROUTE_NUMBER    );

CREATE UNIQUE INDEX ROUTE_LOCATIONS_FKEY ON ROUTE
    (   LOCATION_CODE_START,
        LOCATION_CODE_END,
        START_DATE
    );

-- CREATE THE ROUTE_LEG ENTITY.
CREATE TABLE ROUTE_LEG
    (   ROUTE_NUMBER             INTEGER     NOT NULL
                  REFERENCES ROUTE (ROUTE_NUMBER),
        LEG_NUMBER               INTEGER     NOT NULL,
        LOCATION_CODE_FROM       INTEGER     NOT NULL
            REFERENCES LOCATION (LOCATION_CODE),
        LOCATION_CODE_TO         INTEGER     NOT NULL
            REFERENCES LOCATION (LOCATION_CODE)
    );

ALTER TABLE ROUTE_LEG
    OWNER TO POSTGRES;

ALTER TABLE ONLY ROUTE_LEG
    ADD CONSTRAINT ROUTE_LEG_PK
        PRIMARY KEY (ROUTE_NUMBER, LEG_NUMBER);


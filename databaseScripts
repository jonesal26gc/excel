
-- CREATE SCHEMA SHIPPING;
SET SEARCH_PATH = PUBLIC, PG_CATALOG;

-- Create SEQUENCE tables for ROUTE and LEG.
create sequence
    route_number_sequence
        minvalue 0 maxvalue 2147483647;
create sequence
     leg_number_sequence
         minvalue 0 maxvalue 2147483647;

-- CREATE THE LOCATION ENTITY.
CREATE TABLE LOCATION
    (   LOCATION_CODE       INTEGER           NOT NULL,
        LOCATION_TYPE_CODE  CHAR(5)           NOT NULL,
        NAME                CHAR VARYING(80)  NOT NULL,
        FORMAT              CHAR VARYING(20),
        COUNTY              CHAR VARYING(40),
        POSTCODE            CHAR VARYING(10),
        COUNTRY             CHAR VARYING(40),
        REPORTING_REGION    CHAR VARYING(20),
        PRIMARY KEY (LOCATION_CODE)
    );

ALTER TABLE LOCATION
    OWNER TO POSTGRES;

-- CREATE THE ROUTE ENTITY.
CREATE TABLE ROUTE
    (   ROUTE_NUMBER            INTEGER      NOT NULL,
        ROUTE_TYPE_CODE         CHAR(5)      NOT NULL,
        LOCATION_CODE_START     INTEGER      NOT NULL,
        LOCATION_CODE_END       INTEGER      NOT NULL,
        START_DATE              DATE         NOT NULL,
        END_DATE                DATE         NOT NULL,
        PRIMARY KEY (ROUTE_NUMBER),
        FOREIGN KEY (LOCATION_CODE_START) REFERENCES LOCATION (LOCATION_CODE),
        FOREIGN KEY (LOCATION_CODE_END)   REFERENCES LOCATION (LOCATION_CODE)
    );

ALTER TABLE ROUTE
    OWNER TO POSTGRES;

CREATE UNIQUE INDEX ROUTE_LOCATIONS_START_DATE_SK ON ROUTE
    (   LOCATION_CODE_START,
        LOCATION_CODE_END,
        START_DATE
    );

-- CREATE THE ROUTE_LEG ENTITY.
CREATE TABLE ROUTE_LEG
    (   LEG_NUMBER               INTEGER     NOT NULL,
        ROUTE_NUMBER             INTEGER     NOT NULL,
        LOCATION_CODE_FROM       INTEGER     NOT NULL,
        LOCATION_CODE_TO         INTEGER     NOT NULL,
        PRIMARY KEY (LEG_NUMBER),
        FOREIGN KEY (ROUTE_NUMBER) REFERENCES ROUTE (ROUTE_NUMBER) ON DELETE CASCADE,
        FOREIGN KEY (LOCATION_CODE_FROM) REFERENCES LOCATION (LOCATION_CODE),
        FOREIGN KEY (LOCATION_CODE_TO) REFERENCES LOCATION (LOCATION_CODE)
    );

ALTER TABLE ROUTE_LEG
    OWNER TO POSTGRES;

CREATE UNIQUE INDEX ROUTE_LEG_SK ON ROUTE_LEG
    (ROUTE_NUMBER,
     LEG_NUMBER);


